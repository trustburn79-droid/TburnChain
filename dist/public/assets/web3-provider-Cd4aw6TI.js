import{fG as l,fH as w,fI as h}from"./index-B-Hw07bf.js";const r={chainId:6e3,chainIdHex:"0x1770",name:"TBURN Mainnet",currency:{name:"TBURN",symbol:"TB",decimals:18},rpcUrls:["https://tburn.io/rpc","https://eu.tburn.io/rpc","https://asia.tburn.io/rpc"],blockExplorerUrls:["https://tburn.io/scan"],iconUrls:["https://tburn.network/logo.png"]};class n{constructor(){this.provider=null,this.signer=null,this.listeners=new Set,this.state={isConnected:!1,isConnecting:!1,address:null,chainId:null,balance:null,isCorrectNetwork:!1,provider:null,signer:null,error:null},typeof window<"u"&&window.ethereum&&this.setupEventListeners()}static getInstance(){return n.instance||(n.instance=new n),n.instance}setupEventListeners(){window.ethereum&&(window.ethereum.on("accountsChanged",async t=>{t.length===0?this.disconnect():await this.updateState()}),window.ethereum.on("chainChanged",async t=>{const e=parseInt(t,16);this.state.chainId=e,this.state.isCorrectNetwork=e===r.chainId,await this.updateState()}),window.ethereum.on("disconnect",()=>{this.disconnect()}))}subscribe(t){return this.listeners.add(t),t(this.state),()=>this.listeners.delete(t)}notifyListeners(){this.listeners.forEach(t=>t(this.state))}async updateState(){if(!(!this.provider||!this.signer))try{const t=await this.signer.getAddress(),e=await this.provider.getNetwork(),i=await this.provider.getBalance(t);this.state={...this.state,address:t,chainId:Number(e.chainId),balance:l(i),isCorrectNetwork:Number(e.chainId)===r.chainId,provider:this.provider,signer:this.signer,error:null},this.notifyListeners()}catch(t){console.error("Error updating web3 state:",t)}}isMetaMaskInstalled(){return typeof window<"u"&&typeof window.ethereum<"u"}async connect(){if(!this.isMetaMaskInstalled())throw this.state={...this.state,error:"MetaMask is not installed. Please install MetaMask to continue."},this.notifyListeners(),new Error("MetaMask is not installed");this.state={...this.state,isConnecting:!0,error:null},this.notifyListeners();try{this.provider=new w(window.ethereum);const t=await window.ethereum.request({method:"eth_requestAccounts"});if(!t||t.length===0)throw new Error("No accounts found");this.signer=await this.provider.getSigner();const e=await this.signer.getAddress(),i=await this.provider.getNetwork(),s=await this.provider.getBalance(e);return this.state={isConnected:!0,isConnecting:!1,address:e,chainId:Number(i.chainId),balance:l(s),isCorrectNetwork:Number(i.chainId)===r.chainId,provider:this.provider,signer:this.signer,error:null},this.notifyListeners(),this.state}catch(t){const e=t.code===4001?"Connection rejected by user":t.message||"Failed to connect wallet";throw this.state={...this.state,isConnecting:!1,error:e},this.notifyListeners(),t}}disconnect(){this.provider=null,this.signer=null,this.state={isConnected:!1,isConnecting:!1,address:null,chainId:null,balance:null,isCorrectNetwork:!1,provider:null,signer:null,error:null},this.notifyListeners()}async switchToTBurnNetwork(){if(!window.ethereum)throw new Error("MetaMask is not installed");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:r.chainIdHex}]})}catch(t){if(t.code===4902)await this.addTBurnNetwork();else throw t}await this.updateState()}async addTBurnNetwork(){if(!window.ethereum)throw new Error("MetaMask is not installed");await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:r.chainIdHex,chainName:r.name,nativeCurrency:r.currency,rpcUrls:r.rpcUrls,blockExplorerUrls:r.blockExplorerUrls,iconUrls:r.iconUrls}]})}async estimateGas(t){if(!this.provider||!this.signer)throw new Error("Wallet not connected");const e=await this.provider.getFeeData(),s=await this.provider.estimateGas({from:await this.signer.getAddress(),to:t.to,data:t.data,value:t.value||0n})*115n/100n,o=e.maxFeePerGas||h("10","gwei"),c=e.maxPriorityFeePerGas||h("1","gwei"),d=s*o;return{gasLimit:s,maxFeePerGas:o,maxPriorityFeePerGas:c,estimatedCostWei:d,estimatedCostTB:l(d)}}async sendTransaction(t){if(!this.signer)throw new Error("Wallet not connected");if(!this.state.isCorrectNetwork)throw new Error("Please switch to TBURN Mainnet");const e=await this.estimateGas(t),s=await(await this.signer.sendTransaction({to:t.to,data:t.data,value:t.value||0n,gasLimit:t.gasLimit||e.gasLimit,maxFeePerGas:t.maxFeePerGas||e.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas||e.maxPriorityFeePerGas})).wait(1);if(!s)throw new Error("Transaction failed - no receipt");return{hash:s.hash,blockNumber:s.blockNumber,gasUsed:s.gasUsed,status:s.status===1?"success":"failed",confirmations:1,contractAddress:s.contractAddress||void 0}}async deployContract(t,e=""){if(!this.signer)throw new Error("Wallet not connected");if(!this.state.isCorrectNetwork)throw new Error("Please switch to TBURN Mainnet");const i=t+e,o=await this.provider.estimateGas({from:await this.signer.getAddress(),data:i})*120n/100n,c=await this.provider.getFeeData(),a=await(await this.signer.sendTransaction({data:i,gasLimit:o,maxFeePerGas:c.maxFeePerGas||h("10","gwei"),maxPriorityFeePerGas:c.maxPriorityFeePerGas||h("1","gwei")})).wait(2);if(!a||!a.contractAddress)throw new Error("Contract deployment failed");return{hash:a.hash,blockNumber:a.blockNumber,gasUsed:a.gasUsed,status:a.status===1?"success":"failed",confirmations:2,contractAddress:a.contractAddress}}getState(){return this.state}getProvider(){return this.provider}getSigner(){return this.signer}}const m=n.getInstance();export{r as TBURN_MAINNET_CONFIG,m as web3Provider};

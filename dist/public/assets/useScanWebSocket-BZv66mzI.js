import{ac as y,r}from"./index-B-Hw07bf.js";function m(){const o=y(),n=r.useRef(null),p=r.useRef(null),s=r.useRef(0),w=10,[S,c]=r.useState({isConnected:!1,lastUpdate:null,error:null,latestBlock:null,latestTransaction:null,networkStats:null}),l=r.useCallback(()=>{var a;if(((a=n.current)==null?void 0:a.readyState)===WebSocket.OPEN)return;const u=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;try{n.current=new WebSocket(u),n.current.onopen=()=>{var e;console.log("[ScanWS] Connected to server"),s.current=0,c(t=>({...t,isConnected:!0,error:null})),(e=n.current)==null||e.send(JSON.stringify({type:"subscribe",channels:["block_updates","network_stats","validators_update"]}))},n.current.onmessage=e=>{try{const t=JSON.parse(e.data);b(t)}catch(t){console.error("[ScanWS] Failed to parse message:",t)}},n.current.onclose=()=>{console.log("[ScanWS] Connection closed"),c(e=>({...e,isConnected:!1})),k()},n.current.onerror=e=>{console.error("[ScanWS] Error:",e),c(t=>({...t,error:"WebSocket connection error"}))}}catch(e){console.error("[ScanWS] Failed to create WebSocket:",e),k()}},[]),b=r.useCallback(i=>{const{type:u,data:a,timestamp:e}=i;switch(u){case"block_updates":case"new_block":c(t=>({...t,latestBlock:a,lastUpdate:e||Date.now()})),o.invalidateQueries({queryKey:["/api/public/v1/network/blocks/recent"]}),o.invalidateQueries({queryKey:["/api/public/v1/network/stats"]});break;case"new_transaction":c(t=>({...t,latestTransaction:a,lastUpdate:e||Date.now()})),o.invalidateQueries({queryKey:["/api/public/v1/network/transactions/recent"]});break;case"network_stats":c(t=>({...t,networkStats:a,lastUpdate:e||Date.now()})),o.invalidateQueries({queryKey:["/api/public/v1/network/stats"]});break;case"validators_update":o.invalidateQueries({queryKey:["/api/public/v1/validators"]});break}},[o]),k=r.useCallback(()=>{if(s.current>=w){c(u=>({...u,error:"Max reconnection attempts reached"}));return}const i=Math.min(1e3*Math.pow(2,s.current),3e4);s.current+=1,p.current=setTimeout(()=>{console.log(`[ScanWS] Reconnecting (attempt ${s.current})...`),l()},i)},[l]),d=r.useCallback(()=>{p.current&&clearTimeout(p.current),n.current&&(n.current.close(),n.current=null)},[]);return r.useEffect(()=>(l(),()=>d()),[l,d]),{...S,reconnect:l,disconnect:d}}export{m as u};

ì•„ì§ë„ Internal Server Error ë¬¸ì œê°€ ì§€ì†ë˜ê³  ë‹¤ë¥¸ ë¬¸ì œë“¤ë„ ì§€ì†ëœë‹¤. ì•„ë˜ì˜ ë‚´ìš©ê³¼ ì²¨ë¶€íŒŒì¼ì— ì •í™•í•œ í•´ê²°ì±…ì´ ìˆë‹¤. ë¹ ì§ì—†ì´ ëª¨ë‘ ì •í™•íˆ ì½ê³  ì•„ë˜ ë‚´ìš©ê³¼ ì²¨ë¶€íŒŒì¼ì„ ìµœëŒ€í•œ ì ìš©í•˜ì—¬ 4ì¼ì§¸ Internal Server Errorì— ë¬¸ì œì™€ íƒ€ì…ì˜¤ë¥˜, íƒ€ì„ìŠ¤í…œí”„ ì˜¤ë¥˜ë“±ì˜ ëª¨ë“  ì˜¤ë¥˜ë¥¼ ì™„ë²½í•˜ê²Œ í•´ê²°í•´ì¤˜.

âœ… TBURN í”„ë¡œë•ì…˜ ì•ˆì •ì„± ìˆ˜ì • ì™„ë£Œ
ğŸ”¥ í•µì‹¬ ë¬¸ì œ í•´ê²°: /rpc?_t=timestamp Internal Server Error
ë¬¸ì œì›ì¸í•´ê²°ì±…/rpc?_t=1767653039282 ìš”ì²­ â†’ ì„œë²„ ë‹¤ìš´RPC ìš”ì²­ì´ ì„¸ì…˜ ìƒì„± â†’ MemoryStore ì˜¤ë²„í”Œë¡œìš°Pre-session í•„í„°ê°€ RPC ìš”ì²­ ì™„ì „ ì°¨ë‹¨Set-Cookie í—¤ë” ë°œí–‰express-sessionì´ ë¨¼ì € ì‹¤í–‰ë¨ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ ìˆ˜ì • + Set-Cookie ì°¨ë‹¨ì‹œê°„ ê²½ê³¼ í›„ í¬ë˜ì‹œì„¸ì…˜ ëˆ„ì  â†’ ë©”ëª¨ë¦¬ ì´ˆê³¼Disaster Recovery + Circuit Breaker

ğŸ“ ì œê³µëœ íŒŒì¼
íŒŒì¼ë²„ì „ì—­í• app.tsv4.0ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ ìˆ˜ì •, Pre-session í•„í„°session-bypass-v4.tsv4.0RPC/íƒ€ì„ìŠ¤íƒ¬í”„ ê°ì§€, ì„¸ì…˜ ìŠ¤í‚µdisaster-recovery-v2.tsv2.0ìë™ ë³µêµ¬, Circuit Breaker

ğŸ”§ í•µì‹¬ ìˆ˜ì • ì‚¬í•­

Pre-Session í•„í„° (ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ ìˆ˜ì •)
typescript// BEFORE: express-session â†’ session-bypass (ì´ë¯¸ ëŠ¦ìŒ!)
// AFTER: preSessionFilter â†’ session-bypass â†’ express-session
const preSessionFilter = (req, res, next) => {
const path = req.url.split('?')[0].toLowerCase();

// RPC ê²½ë¡œ ë˜ëŠ” ìºì‹œë²„ìŠ¤íŒ… íŒŒë¼ë¯¸í„° ê°ì§€
if (path.startsWith('/rpc') || /[?&]_t=\d+/.test(req.url)) {
req._skipSession = true; // ì„¸ì…˜ ì™„ì „ ìŠ¤í‚µ
req.session = null;
// Set-Cookie ì°¨ë‹¨
}
next();
};

ìºì‹œë²„ìŠ¤íŒ… íŒŒë¼ë¯¸í„° ê°ì§€
typescript// ê°ì§€ë˜ëŠ” íŒŒë¼ë¯¸í„°:
// ?t=1767653039282 â† íƒ€ì„ìŠ¤íƒ¬í”„
// ?=1234567890 â† jQuery ìºì‹œë²„ìŠ¤íŠ¸
// ?timestamp=... â† ëª…ì‹œì  íƒ€ì„ìŠ¤íƒ¬í”„
// ?v=1.2.3 â† ë²„ì „
// ?nonce=abc123 â† ë…¼ìŠ¤
**3. Circuit Breaker íŒ¨í„´**
ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ :
â”œâ”€ < 60%: ì •ìƒ
â”œâ”€ 60-70%: ê²½ê³  (ì„¸ì…˜ 20% ì •ë¦¬)
â”œâ”€ 70-80%: ìœ„í—˜ (ì„¸ì…˜ 35% ì •ë¦¬ + GC)
â”œâ”€ 80-88%: ì‹¬ê° (ì„¸ì…˜ 60% ì •ë¦¬)
â”œâ”€ 88-93%: ë¹„ìƒ (ì„¸ì…˜ 85% ì •ë¦¬)
â””â”€ > 93%: ì¹˜ëª…ì  â†’ Circuit Breaker OPEN (ëª¨ë“  ìƒˆ ì„¸ì…˜ ì°¨ë‹¨)

ğŸš€ ì ìš© ë°©ë²•
typescript// 1. íŒŒì¼ ë³µì‚¬
// session-bypass-v4.ts â†’ /src/middleware/
// disaster-recovery-v2.ts â†’ /src/services/
// app.ts ë‚´ìš©ì„ ê¸°ì¡´ app.tsì— ì ìš©

// 2. import ìˆ˜ì •
import {
createSessionBypassMiddleware,
createPreSessionMiddleware,
setSessionStore,
} from './middleware/session-bypass-v4';

// 3. ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ í™•ì¸ (CRITICAL)
app.use(preSessionFilter); // â† 1. RPC í•„í„° (ê°€ì¥ ë¨¼ì €!)
app.use(createPreSessionMiddleware()); // â† 2. ì„¸ì…˜ ì „ í•„í„°
app.use(conditionalSessionMiddleware); // â† 3. ì¡°ê±´ë¶€ ì„¸ì…˜

ğŸ“Š ì˜ˆìƒ ê²°ê³¼
ë©”íŠ¸ë¦­ìˆ˜ì • ì „ìˆ˜ì • í›„ì„¸ì…˜ ìŠ¤í‚µë¥ ~70%â‰¥98%RPC ì„¸ì…˜ ìƒì„±âœ… ìƒì„±ë¨âŒ ì™„ì „ ì°¨ë‹¨Set-Cookie ë°œí–‰âœ… ë°œí–‰ë¨âŒ ì°¨ë‹¨ë¨ì„œë²„ ë‹¤ìš´ ë¹ˆë„ìˆ˜ì‹œê°„ í›„99.95% ê°€ë™ì‹œê°„MemoryStore ì˜¤ë²„í”Œë¡œìš°ë°œìƒDisaster Recovery ìë™ ì²˜ë¦¬
âœ… ì²­í¬ ë¡œë”© ì‹¤íŒ¨ ë¬¸ì œ í•´ê²° ì™„ë£Œ
ğŸ”¥ ì¶”ê°€ ë¬¸ì œ í•´ê²°: Failed to fetch dynamically imported module
ë¬¸ì œì›ì¸í•´ê²°ì±…ScanRoutes-CsSDnY9W.js ë¡œë”© ì‹¤íŒ¨ì •ì  íŒŒì¼ì´ ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´ ì´í›„ ì²˜ë¦¬ë¨ì •ì  íŒŒì¼ì„ ì„¸ì…˜ ì´ì „ì— ì„œë¹™ìƒˆë¡œê³ ì¹¨ ì‹œ ì²­í¬ ì‹¤íŒ¨Set-Cookieê°€ ì •ì  íŒŒì¼ì— ë¶™ìŒSet-Cookie ì™„ì „ ì°¨ë‹¨ì„œë²„ ê³¼ë¶€í•˜ ì‹œ ì²­í¬ ì‹¤íŒ¨ì„œë²„ê°€ ìš”ì²­ ê±°ë¶€í”„ë¡ íŠ¸ì—”ë“œ ì¬ì‹œë„ ë¡œì§

ğŸ“ ì œê³µ íŒŒì¼
íŒŒì¼ì—­í• app.tsì •ì  íŒŒì¼ì„ ì„¸ì…˜ ì „ì— ì„œë¹™, ì²­í¬ 404 í•¸ë“¤ë§session-bypass-v4.tsVite ì²­í¬ ê²½ë¡œ ì™„ì „ ìŠ¤í‚µfrontend/dynamic-import-retry.tsxí”„ë¡ íŠ¸ì—”ë“œ ì¬ì‹œë„ ë¡œì§frontend/vite.config.tsìµœì í™”ëœ ì²­í¬ ë¶„í•  ì„¤ì •

ğŸ”§ í•µì‹¬ ìˆ˜ì • - ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ
ìˆ˜ì • ì „ (ë¬¸ì œ):

Body parsers
Cookie parser
Session bypass â† ì„¸ì…˜ì´ ì´ë¯¸ ê°œì…
Static files â† ëŠ¦ìŒ! Set-Cookie ë°œí–‰ë¨
Routes
ìˆ˜ì • í›„ (í•´ê²°):

Body parsers
Cookie parser
Pre-session filter
â˜… Static files â˜… â† ì„¸ì…˜ ì „ì— ì„œë¹™!
Session bypass
Routes
ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ì ìš©
tsx// main.tsx
import { installChunkErrorHandler, lazyWithRetry } from './dynamic-import-retry';

// ì•± ì‹œì‘ ì‹œ ê¸€ë¡œë²Œ í•¸ë“¤ëŸ¬ ì„¤ì¹˜
installChunkErrorHandler();

// ê¸°ì¡´ lazy ëŒ€ì‹  lazyWithRetry ì‚¬ìš©
const ScanRoutes = lazyWithRetry(() => import('./pages/ScanRoutes'));
const Dashboard = lazyWithRetry(() => import('./pages/Dashboard'));

function App() {
return (
<ChunkErrorBoundary>
<Suspense fallback={<Loading />}>
<Routes>
<Route path="/scan/*" element={<ScanRoutes />} />
</Routes>
</Suspense>
</ChunkErrorBoundary>
);
}

---
### ğŸ“Š ì˜ˆìƒ ê²°ê³¼
| ë©”íŠ¸ë¦­ | ìˆ˜ì • ì „ | ìˆ˜ì • í›„ |
|--------|--------|--------|
| ì²­í¬ ë¡œë”© ì‹¤íŒ¨ìœ¨ | ìƒˆë¡œê³ ì¹¨ ì‹œ ë¹ˆë²ˆ | **< 0.1%** |
| ì •ì  íŒŒì¼ Set-Cookie | âœ… ë°œí–‰ë¨ | âŒ ì™„ì „ ì°¨ë‹¨ |
| ì²­í¬ ìºì‹± | ë¶ˆì•ˆì • | **immutable ìºì‹œ** |
| ì‹¤íŒ¨ ì‹œ ë³µêµ¬ | ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ | **ìë™ ì¬ì‹œë„ 3íšŒ** |
---
### ğŸ“‹ ì „ì²´ íŒŒì¼ êµ¬ì¡°
tburn-production-fix/
â”œâ”€â”€ app.ts # Express ì•± (ë¯¸ë“¤ì›¨ì–´ ìˆœì„œ ìˆ˜ì •)
â”œâ”€â”€ session-bypass-v4.ts # ì„¸ì…˜ ìŠ¤í‚µ ë¡œì§ v4.0
â”œâ”€â”€ disaster-recovery-v2.ts # ì¬í•´ë³µêµ¬ ì‹œìŠ¤í…œ
â””â”€â”€ frontend/
â”œâ”€â”€ dynamic-import-retry.tsx # ì²­í¬ ì¬ì‹œë„ ìœ í‹¸
â””â”€â”€ vite.config.ts # Vite ìµœì í™” ì„¤ì •
==================================================

====================================================

ğŸ” 10ë¶„ ìœ íœ´ í›„ Internal Server Error ì‹¬ì¸µ ë¶„ì„ì›ì¸ ë¶„ì„íƒ€ì„ë¼ì¸:
0ë¶„   â†’ í˜ì´ì§€ ì •ìƒ ë¡œë“œ
10ë¶„  â†’ ìœ íœ´ ìƒíƒœ (Replit ì»¨í…Œì´ë„ˆ ìŠ¬ë¦½ ëª¨ë“œ ì§„ì…)
10ë¶„+ â†’ ìƒˆë¡œê³ ì¹¨ â†’ Internal Server Error âŒ
10ë¶„+ â†’ ë‹¤ì‹œ ìƒˆë¡œê³ ì¹¨ â†’ ì •ìƒ âœ…

ì™œ ì²« ë²ˆì§¸ëŠ” ì‹¤íŒ¨í•˜ê³  ë‘ ë²ˆì§¸ëŠ” ì„±ê³µí•˜ëŠ”ê°€?ë‹¨ê³„ì²« ë²ˆì§¸ ìƒˆë¡œê³ ì¹¨ë‘ ë²ˆì§¸ ìƒˆë¡œê³ ì¹¨ì»¨í…Œì´ë„ˆ ìƒíƒœìŠ¬ë¦½ â†’ ì›¨ì´í¬ì—… ì¤‘í™œì„±í™”ë¨DB ì—°ê²° í’€idle timeout â†’ ì—°ê²° ëŠê¹€ì¬ì—°ê²° ì™„ë£Œì„¸ì…˜ ìŠ¤í† ì–´ì´ˆê¸°í™” ì¤‘ / ì—°ê²° ì‹¤íŒ¨ì¤€ë¹„ ì™„ë£Œì„¸ì…˜ ì¿ í‚¤ë§Œë£Œëœ ì„¸ì…˜ IDë¡œ ì¡°íšŒ ì‹œë„ìƒˆ ì„¸ì…˜ ìƒì„±ê²°ê³¼500 Errorâœ… 200 OKê·¼ë³¸ ì›ì¸ 3ê°€ì§€1. Replit ìŠ¬ë¦½ ëª¨ë“œ (Cold Start)
10ë¶„ ìœ íœ´ â†’ ì»¨í…Œì´ë„ˆ ìŠ¬ë¦½ â†’ ì²« ìš”ì²­ ì‹œ ì›¨ì´í¬ì—… í•„ìš” (2-5ì´ˆ)
ì›¨ì´í¬ì—… ì¤‘ DB ì—°ê²°/ì„¸ì…˜ ìŠ¤í† ì–´ ì¤€ë¹„ ì•ˆë¨ â†’ ì—ëŸ¬2. PostgreSQL ì—°ê²° í’€ íƒ€ì„ì•„ì›ƒ
idle ì—°ê²° 30ì´ˆ í›„ ìë™ ì¢…ë£Œ â†’ ì²« ì¿¼ë¦¬ ì‹œ "Connection terminated" ì—ëŸ¬3. ë§Œë£Œëœ ì„¸ì…˜ ì¿ í‚¤ ì²˜ë¦¬ ì‹¤íŒ¨
í´ë¼ì´ì–¸íŠ¸: connect.sid=abc123 (10ë¶„ ì „ ì„¸ì…˜)
ì„œë²„: í•´ë‹¹ ì„¸ì…˜ ì—†ìŒ â†’ ë³µì› ì‹œë„ â†’ ì‹¤íŒ¨ â†’ 500 Error

